# 爬虫学习笔记—re库

re即为正则表达式,用于从字符串中匹配提取信息,语法如下:

| 表达式   | 功能                   | 实例                             |
| ----- | -------------------- | ------------------------------ |
| .     | 表示任何单个字符             |                                |
| [   ] | 字符集，对单个字符给出取值范围      | [ab]表示a、b，[a-z]表示a到z单个字        |
| [^ ]  | 非字符集，对单个字符给出排除范围     | [^abc]表示非a或b或c的单个字符            |
| *     | 前一个字符0次或无限次扩展        | abc* 表示ab、abc、abcc、abccc等      |
| +     | 前一个字符1次或无限次扩展        | abc+ 表示abc、abcc、abccc等         |
| ?     | 前一个字符0次或1次扩展         | abc? 表示ab、abc                  |
| \|    | 左右表达式任意一个            | abc\|def 表示abc、def             |
| {m}   | 扩展前一个字符m次            | ab{2}c表示abbc                   |
| {m,n} | 扩展前一个字符m至n次（含n）      | ab{1,2}c表示abc、abbc             |
| ^     | 匹配字符串开头              | ^abc表示abc且在一个字符串的开头            |
| $     | 匹配字符串结尾              | abc$表示abc且在一个字符串的结尾            |
| ( )   | 分组标记，内部只能使用\| 操作符    | (abc)表示abc，(abc\|def)表示abc、def |
| \d    | 数字，等价于[0‐9]          |                                |
| \w    | 单词字符，等价于[A‐Za‐z0‐9_] |                                |

## 正则表达式实例

```python
P(Y|YT|YTH|YTHO)?N      #'PN'、'PYN'、'PYTN'、'PYTHN'、'PYTHON'  
PYTHON+                 #'PYTHON'、'PYTHONN'、'PYTHONNN' …  
PY[TH]ON                #'PYTON'、'PYHON'  
PY[^TH]?ON              #'PYON'、'PYaON'、'PYbON'、'PYcON'…  
PY{:3}N                 #'PN'、'PYN'、'PYYN'、'PYYYN'
```

```python
^[A-Za-z]+$                #由26个字母组成的字符串  
^[A-Za-z0-9]+$             #由26个字母和数字组成的字符串  
^-?\d+$                    #整数形式的字符串  
^[0-9]*[1-9][0-9]*$        #正整数形式的字符串  
[1-9]\d{5}                 #中国境内邮政编码，6位  
[\u4e00-\u9fa5]            #匹配中文字符
\d{3}‐\d{8}|\d{4}‐\d{7}    #国内电话号码
```

```python
(([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5]).){3}([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5])  #匹配ip地址
```

## re库的使用

使用前导入:`import re`

#### 主要函数:

| 函数            | 功能                                 |
| ------------- | ---------------------------------- |
| re.search()   | 在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象   |
| re.match()    | 从一个字符串的开始位置起匹配正则表达式，返回match对象      |
| re.findall()  | 搜索字符串，以列表类型返回全部能匹配的子串              |
| re.split()    | 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型       |
| re.finditer() | 搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象 |
| re.sub()      | 在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串    |

####主要参数:

`pattern`:正则表达式的原生字符串形式(r'Expression')

`string`:待匹配字符串

`flags`:控制标记,如下

`re.I re.IGNORECASE` 忽略正则表达式的大小写，[A‐Z]能够匹配小写字符

`re.M re.MULTILINE` 正则表达式中的^操作符能够将给定字符串的每行当作匹配开始

`re.S re.DOTALL` 正则表达式中的.操作符能够匹配所有字符，默认匹配除换行外的所有字符

#### Match对象:

一次匹配的结果,属性和方法如下:

| **属性**  | 说明                    | **方法**    | 说明                   |
| ------- | --------------------- | --------- | -------------------- |
| .string | 待匹配的文本                | .group(0) | 获得匹配后的字符串            |
| .re     | 匹配时使用的patter对象（正则表达式） | .start()  | 匹配字符串在原始字符串的开始位置     |
| .pos    | 正则表达式搜索文本的开始位置        | .end()    | 匹配字符串在原始字符串的结束位置     |
| .endpos | 正则表达式搜索文本的结束位置        | .span()   | 返回(.start(), .end()) |

#### 最小匹配与贪婪匹配:

最小匹配指匹配最短的符合条件的字符串,贪婪匹配则是匹配最长的符合条件的字符串

re库默认采用贪婪匹配,可以通过在操作符后加上?来启用最小匹配

贪婪匹配实例:`re.search(r'PY.*N', 'PYANBNCNDN')    #'PYANBNCNDN' `

最小匹配实例:`re.search(r'PY.*?N', 'PYANBNCNDN')  #'PYAN'`

